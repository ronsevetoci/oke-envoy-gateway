apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyProxy
metadata:
  name: oci-lb-proxy
  namespace: envoy-gateway-system
spec:
  provider:
    type: Kubernetes
    kubernetes:
      envoyService:
        type: LoadBalancer
        allocateLoadBalancerNodePorts: false
        externalTrafficPolicy: Cluster
        annotations:
          oci.oraclecloud.com/load-balancer-type: "lb"
          service.beta.kubernetes.io/oci-load-balancer-shape: "flexible"
          service.beta.kubernetes.io/oci-load-balancer-shape-flex-min: "10"
          service.beta.kubernetes.io/oci-load-balancer-shape-flex-max: "100"
          oci-load-balancer.oraclecloud.com/health-check: '{"protocol":"HTTP","port":10080,"urlPath":"/","retries":3,"timeoutInMillis":4000}'
          oci.oraclecloud.com/security-rule-management-mode: "NSG"
          oci.oraclecloud.com/oci-backend-network-security-group: "ocid1.networksecuritygroup.oc1.eu-frankfurt-1.aaaaaaaagwg664yixfjgvzmvimwxxor7sjlklxg2qnyjmvgyulf66xv4fcba" # Replace with the OCID of the NSG associated with the Pods subnet
          oci-load-balancer.oraclecloud.com/backend-protocol: "HTTP"